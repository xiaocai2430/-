<!DOCTYPE html>
<html>
  <head>
    <title>任务开发视窗(二）</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link href="resources/css/jquery-ui-themes.css" type="text/css" rel="stylesheet"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/任务开发视窗_二）/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-1.7.1.min.js"></script>
    <script src="resources/scripts/jquery-ui-1.8.10.custom.min.js"></script>
    <script src="resources/scripts/prototypePre.js"></script>
    <script src="data/document.js"></script>
    <script src="resources/scripts/prototypePost.js"></script>
    <script src="files/任务开发视窗_二）/data.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
  </head>
  <body>
    <div id="base" class="">

      <!-- Unnamed (组合 ) -->
      <div id="u493" class="ax_default" data-left="0" data-top="0" data-width="1918" data-height="65">

        <!-- Unnamed (矩形) -->
        <div id="u494" class="ax_default box_2">
          <div id="u494_div" class=""></div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u495" class="ax_default" data-left="29" data-top="19" data-width="91" data-height="27">

          <!-- Unnamed (图片 ) -->
          <div id="u496" class="ax_default _图片_">
            <img id="u496_img" class="img " src="images/udf管理（正常）/u3.png"/>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u497" class="ax_default label">
            <div id="u497_div" class=""></div>
            <div id="u497_text" class="text ">
              <p><span>达数据</span></p>
            </div>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u498" class="ax_default" data-left="186" data-top="23" data-width="606" data-height="32">

          <!-- Unnamed (矩形) -->
          <div id="u499" class="ax_default label">
            <div id="u499_div" class=""></div>
            <div id="u499_text" class="text ">
              <p><span>首页</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u500" class="ax_default label">
            <div id="u500_div" class=""></div>
            <div id="u500_text" class="text ">
              <p><span>数据应用</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u501" class="ax_default label">
            <div id="u501_div" class=""></div>
            <div id="u501_text" class="text ">
              <p><span>数据管理</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u502" class="ax_default label">
            <div id="u502_div" class=""></div>
            <div id="u502_text" class="text ">
              <p><span>数据开发</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u503" class="ax_default label">
            <div id="u503_div" class=""></div>
            <div id="u503_text" class="text ">
              <p><span>数据运维</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u504" class="ax_default label">
            <div id="u504_div" class=""></div>
            <div id="u504_text" class="text ">
              <p><span>数据安全</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u505" class="ax_default label">
            <div id="u505_div" class=""></div>
            <div id="u505_text" class="text ">
              <p><span>其他工具</span></p>
            </div>
          </div>

          <!-- Unnamed (水平线) -->
          <div id="u506" class="ax_default line">
            <img id="u506_img" class="img " src="images/udf管理（正常）/u13.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u507" class="ax_default" data-left="1602" data-top="17" data-width="276" data-height="32">

          <!-- Unnamed (矩形) -->
          <div id="u508" class="ax_default label">
            <div id="u508_div" class=""></div>
            <div id="u508_text" class="text ">
              <p><span>文档</span></p>
            </div>
          </div>

          <!-- Unnamed (组合 ) -->
          <div id="u509" class="ax_default" data-left="1602" data-top="17" data-width="123" data-height="32">

            <!-- Unnamed (矩形) -->
            <div id="u510" class="ax_default shape">
              <div id="u510_div" class=""></div>
              <div id="u510_text" class="text ">
                <p><span>大数据</span></p>
              </div>
            </div>

            <!-- Unnamed (组合 ) -->
            <div id="u511" class="ax_default" data-left="1700" data-top="26" data-width="25" data-height="14">

              <!-- Unnamed (图片 ) -->
              <div id="u512" class="ax_default image1">
                <img id="u512_img" class="img " src="images/udf管理（正常）/u19.png"/>
              </div>

              <!-- Unnamed (矩形) -->
              <div id="u513" class="ax_default box_2">
                <div id="u513_div" class=""></div>
                <div id="u513_text" class="text ">
                  <p><span>8</span></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u514" class="ax_default image">
            <img id="u514_img" class="img " src="images/udf管理（正常）/u21.png"/>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u515" class="ax_default image">
            <img id="u515_img" class="img " src="images/udf管理（正常）/u22.png"/>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u516" class="ax_default image">
            <img id="u516_img" class="img " src="images/udf管理（正常）/u23.png"/>
          </div>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u517" class="ax_default box_2">
        <div id="u517_div" class=""></div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u518" class="ax_default box_2">
        <div id="u518_div" class=""></div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u519" class="ax_default" data-left="134" data-top="81" data-width="100" data-height="35">

        <!-- Unnamed (矩形) -->
        <div id="u520" class="ax_default box_1">
          <div id="u520_div" class=""></div>
          <div id="u520_text" class="text ">
            <p><span>新建任务</span></p>
          </div>
        </div>

        <!-- Unnamed (图片 ) -->
        <div id="u521" class="ax_default image">
          <img id="u521_img" class="img " src="images/任务开发视窗_一）/u284.png"/>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u522" class="ax_default" data-left="74" data-top="81" data-width="50" data-height="35">

        <!-- Unnamed (矩形) -->
        <div id="u523" class="ax_default box_1">
          <div id="u523_div" class=""></div>
        </div>

        <!-- Unnamed (图片 ) -->
        <div id="u524" class="ax_default image">
          <img id="u524_img" class="img " src="images/任务开发视窗_一）/u287.png"/>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u525" class="ax_default" data-left="14" data-top="81" data-width="50" data-height="35">

        <!-- Unnamed (矩形) -->
        <div id="u526" class="ax_default box_1">
          <div id="u526_div" class=""></div>
        </div>

        <!-- Unnamed (图片 ) -->
        <div id="u527" class="ax_default image">
          <img id="u527_img" class="img " src="images/任务开发视窗_一）/u290.png"/>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u528" class="ax_default" data-left="0" data-top="135" data-width="245" data-height="194">

        <!-- Unnamed (组合 ) -->
        <div id="u529" class="ax_default" data-left="0" data-top="135" data-width="245" data-height="24">

          <!-- Unnamed (组合 ) -->
          <div id="u530" class="ax_default" data-left="0" data-top="135" data-width="245" data-height="24">

            <!-- Unnamed (矩形) -->
            <div id="u531" class="ax_default box_21">
              <div id="u531_div" class=""></div>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u532" class="ax_default paragraph">
            <div id="u532_div" class=""></div>
            <div id="u532_text" class="text ">
              <p><span>da(325)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u533" class="ax_default image">
            <img id="u533_img" class="img " src="images/任务开发视窗_一）/u296.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u534" class="ax_default" data-left="29" data-top="169" data-width="80" data-height="24">

          <!-- Unnamed (矩形) -->
          <div id="u535" class="ax_default paragraph">
            <div id="u535_div" class=""></div>
            <div id="u535_text" class="text ">
              <p><span>sc(272)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u536" class="ax_default image">
            <img id="u536_img" class="img " src="images/任务开发视窗_一）/u299.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u537" class="ax_default" data-left="13.9644660940673" data-top="203" data-width="94.0355339059327" data-height="24">

          <!-- Unnamed (Right Triangle) -->
          <div id="u538" class="ax_default box_21">
            <img id="u538_img" class="img " src="images/任务开发视窗_一）/u301.png"/>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u539" class="ax_default paragraph">
            <div id="u539_div" class=""></div>
            <div id="u539_text" class="text ">
              <p><span>tmp(16)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u540" class="ax_default image">
            <img id="u540_img" class="img " src="images/任务开发视窗_一）/u303.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u541" class="ax_default" data-left="29" data-top="237" data-width="153" data-height="24">

          <!-- Unnamed (矩形) -->
          <div id="u542" class="ax_default paragraph">
            <div id="u542_div" class=""></div>
            <div id="u542_text" class="text ">
              <p><span>data_analysis(286)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u543" class="ax_default image">
            <img id="u543_img" class="img " src="images/任务开发视窗_一）/u299.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u544" class="ax_default" data-left="29" data-top="271" data-width="175" data-height="24">

          <!-- Unnamed (矩形) -->
          <div id="u545" class="ax_default paragraph">
            <div id="u545_div" class=""></div>
            <div id="u545_text" class="text ">
              <p><span>data_warehouse(1477)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u546" class="ax_default image">
            <img id="u546_img" class="img " src="images/任务开发视窗_一）/u299.png"/>
          </div>
        </div>

        <!-- Unnamed (组合 ) -->
        <div id="u547" class="ax_default" data-left="29" data-top="305" data-width="118" data-height="24">

          <!-- Unnamed (矩形) -->
          <div id="u548" class="ax_default paragraph">
            <div id="u548_div" class=""></div>
            <div id="u548_text" class="text ">
              <p><span>monitoring(4)</span></p>
            </div>
          </div>

          <!-- Unnamed (图片 ) -->
          <div id="u549" class="ax_default image">
            <img id="u549_img" class="img " src="images/任务开发视窗_一）/u299.png"/>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u550" class="ax_default" data-left="255" data-top="76" data-width="1663" data-height="40">

        <!-- Unnamed (组合 ) -->
        <div id="u551" class="ax_default" data-left="255" data-top="76" data-width="69" data-height="40">

          <!-- Unnamed (矩形) -->
          <div id="u552" class="ax_default shape">
            <div id="u552_div" class=""></div>
            <div id="u552_text" class="text ">
              <p><span>da</span></p>
            </div>
          </div>

          <!-- Unnamed (组合 ) -->
          <div id="u553" class="ax_default" data-left="300" data-top="87" data-width="24" data-height="19">

            <!-- Unnamed (图片 ) -->
            <div id="u554" class="ax_default image1">
              <img id="u554_img" class="img " src="images/udf管理（正常）/u30.png"/>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u555" class="ax_default box_2">
              <div id="u555_div" class=""></div>
              <div id="u555_text" class="text ">
                <p><span>12</span></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Unnamed (水平线) -->
        <div id="u556" class="ax_default line">
          <img id="u556_img" class="img " src="images/任务开发视窗_一）/u319.png"/>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u557" class="ax_default box_2">
        <div id="u557_div" class=""></div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u558" class="ax_default" data-left="333" data-top="76" data-width="194" data-height="40">

        <!-- Unnamed (组合 ) -->
        <div id="u559" class="ax_default" data-left="333" data-top="76" data-width="194" data-height="40">

          <!-- Unnamed (矩形) -->
          <div id="u560" class="ax_default shape">
            <div id="u560_div" class=""></div>
            <div id="u560_text" class="text ">
              <p><span style="font-family:'LucidaGrande', 'Lucida Grande';color:#FFBF00;">●</span><span style="font-family:'Helvetica';color:rgba(0, 0, 0, 0.427450980392157);">&nbsp; </span><span style="font-family:'PingFangSC-Regular', 'PingFang SC';color:#FE7418;">alad_offline_widget</span></p>
            </div>
          </div>

          <!-- Unnamed (组合 ) -->
          <div id="u561" class="ax_default" data-left="499" data-top="87" data-width="24" data-height="19">

            <!-- Unnamed (图片 ) -->
            <div id="u562" class="ax_default image1">
              <img id="u562_img" class="img " src="images/udf管理（正常）/u30.png"/>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u563" class="ax_default box_2">
              <div id="u563_div" class=""></div>
              <div id="u563_text" class="text ">
                <p><span>12</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Unnamed (水平线) -->
      <div id="u564" class="ax_default line">
        <img id="u564_img" class="img " src="images/任务开发视窗_二）/u564.png"/>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u565" class="ax_default" data-left="269" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u566" class="ax_default image">
          <img id="u566_img" class="img " src="images/udf管理（正常）/u42.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u567" class="ax_default paragraph">
          <div id="u567_div" class=""></div>
          <div id="u567_text" class="text ">
            <p><span>保存</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (动态面板) -->
      <div id="u568" class="ax_default">
        <div id="u568_state0" class="panel_state" data-label="State1" style="">
          <div id="u568_state0_content" class="panel_state_content">

            <!-- Unnamed (矩形) -->
            <div id="u569" class="ax_default box_2">
              <div id="u569_div" class=""></div>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u570" class="ax_default _文本段落">
              <div id="u570_div" class=""></div>
              <div id="u570_text" class="text ">
                <p><span style="color:#008000;"># -*-coding:utf-8-*-</span></p><p><span><br></span></p><p><span style="color:#C800A4;">import</span><span> sys</span></p><p><span style="color:#C800A4;">import</span><span> time</span></p><p><span style="color:#C800A4;">from</span><span> datetime </span><span style="color:#C800A4;">import</span><span> datetime</span></p><p><span style="color:#C800A4;">from</span><span> pyspark.sql </span><span style="color:#C800A4;">import</span><span> SparkSession</span></p><p><span style="color:#C800A4;">from</span><span> redis.sentinel </span><span style="color:#C800A4;">import</span><span> Sentinel</span></p><p><span>&nbsp;</span></p><p><span style="color:#008000;"># 定义时间参数用</span></p><p><span>date1 </span><span style="color:#C800A4;">=</span><span> sys.argv[1]&nbsp; </span><span style="color:#008000;"># 当前调度时间的上一个调度时间 格式：20190101</span></p><p><span>date2 </span><span style="color:#C800A4;">=</span><span> sys.argv[2]&nbsp; </span><span style="color:#008000;"># 当前调度时间的上一个调度时间 格式：2019-01-01 23:59:59</span></p><p><span>date2dtm </span><span style="color:#C800A4;">=</span><span> datetime.strptime(date2,</span><span style="color:#FF0000;">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span>)</span></p><p><span>&nbsp;</span></p><p><span>date_time_int </span><span style="color:#C800A4;">=</span><span> int(time.mktime(date2dtm.timetuple()))</span></p><p><span>&nbsp;</span></p><p><span style="color:#008000;">#离线任务用</span></p><p><span>date_1d_YMD </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y%m%d'</span><span>, time.localtime(date_time_int))&nbsp; &nbsp; </span><span style="color:#008000;"># 20190101</span></p><p><span>date_1d_Y_M_D </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y-%m-%d'</span><span>, time.localtime(date_time_int))&nbsp; &nbsp; </span><span style="color:#008000;"># 2019-01-01</span></p><p><span>date_60d_YMD </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y%m%d'</span><span>, time.localtime(date_time_int </span><span style="color:#C800A4;">-</span><span> 86400 </span><span style="color:#C800A4;">*</span><span> 60))&nbsp; &nbsp; </span><span style="color:#008000;"># 86400秒 * 1 = 1天</span></p><p><span>date_60d_Y_M_D </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y-%m-%d'</span><span>, time.localtime(date_time_int </span><span style="color:#C800A4;">-</span><span> 86400 </span><span style="color:#C800A4;">*</span><span> 60))</span></p><p><span>&nbsp;</span></p><p><span style="color:#008000;">#15min、30min、60min用</span></p><p><span>date_1p_YMDHMS </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y%m%d%H%M%S'</span><span>, time.localtime(date_time_int))&nbsp;&nbsp; </span><span style="color:#008000;"># 20190101000000</span></p><p><span>date_1p_Y_M_D_H_M_S </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y-%m-%d %H:%M:%S'</span><span>, time.localtime(date_time_int)) </span><span style="color:#008000;">#2019-01-01 00:00:00</span></p><p><span>date_2p_YMDHMS </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y%m%d%H%M%S'</span><span>, time.localtime(date_time_int </span><span style="color:#C800A4;">-</span><span> 60 </span><span style="color:#C800A4;">*</span><span> 15))&nbsp;&nbsp; </span><span style="color:#008000;"># 60秒 * 15 = 15分钟</span></p><p><span>date_2p_Y_M_D_H_M_S </span><span style="color:#C800A4;">=</span><span> time.strftime(</span><span style="color:#FF0000;">'%Y-%m-%d %H:%M:%S'</span><span>, time.localtime(date_time_int </span><span style="color:#C800A4;">-</span><span> 60 </span><span style="color:#C800A4;">*</span><span> 15))</span></p><p><span><br></span></p><p><span style="color:#C800A4;">def</span><span> channelDataToRedis(partition):</span></p><p><span>&nbsp;&nbsp;&nbsp; sentinel </span><span style="color:#C800A4;">=</span><span> Sentinel([(</span><span style="color:#FF0000;">'172.24.0.6'</span><span>, 26002), (</span><span style="color:#FF0000;">'172.24.0.7'</span><span>, 26002), (</span><span style="color:#FF0000;">'172.24.0.8'</span><span>, 26002)], socket_timeout</span><span style="color:#C800A4;">=</span><span>3)</span></p><p><span>&nbsp;&nbsp;&nbsp; master </span><span style="color:#C800A4;">=</span><span> sentinel.master_for(</span><span style="color:#FF0000;">'bi_product'</span><span>, socket_timeout</span><span style="color:#C800A4;">=</span><span>3, password</span><span style="color:#C800A4;">=</span><span style="color:#FF0000;">'ca31b66a6bb51'</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp; pipe </span><span style="color:#C800A4;">=</span><span> master.pipeline()</span></p><p><span>&nbsp;&nbsp;&nbsp; </span><span style="color:#008000;"># pipe_expire = 600</span></p><p><span><br></span></p><p><span>&nbsp;&nbsp;&nbsp; widget_ids </span><span style="color:#C800A4;">=</span><span> </span><span style="color:#FF0000;">''</span></p><p><span>&nbsp;&nbsp;&nbsp; </span><span style="color:#C800A4;">for</span><span> row </span><span style="color:#C800A4;">in</span><span> partition:</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; value </span><span style="color:#C800A4;">=</span><span> str(row.widget_id)</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span style="color:#008000;"># pipe.expire(key, pipe_expire)</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span style="color:#C800A4;">if</span><span> (widget_ids </span><span style="color:#C800A4;">==</span><span style="color:#FF0000;"> '' </span><span style="color:#C800A4;">and</span><span> value </span><span style="color:#C800A4;">is not None and</span><span> value</span><span style="color:#C800A4;">!=</span><span style="color:#FF0000;">&quot;None&quot;</span><span>):</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; widget_ids </span><span style="color:#C800A4;">=</span><span> value</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span style="color:#C800A4;">else</span><span>:</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span style="color:#C800A4;"> if </span><span>(value </span><span style="color:#C800A4;">is not None and</span><span> value</span><span style="color:#C800A4;">!=</span><span style="color:#FF0000;">&quot;None&quot;</span><span>):</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; widget_ids </span><span style="color:#C800A4;">=</span><span> widget_ids </span><span style="color:#C800A4;">+</span><span> </span><span style="color:#FF0000;">&quot;,&quot;</span><span> </span><span style="color:#C800A4;">+</span><span> value</span></p><p><span>&nbsp;&nbsp;&nbsp; pipe.set(</span><span style="color:#FF0000;">&quot;alad_offline_widget_ids&quot;</span><span>, widget_ids)</span></p><p><span>&nbsp;&nbsp;&nbsp; pipe.execute()</span></p><p><span>&nbsp;</span></p><p><span>&nbsp;</span></p><p><span>spark </span><span style="color:#C800A4;">=</span><span> SparkSession \</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .builder \</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .appName(</span><span style="color:#FF0000;">&quot;alad_offline_widget&quot;</span><span>) \</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .enableHiveSupport() \</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .getOrCreate()</span></p><p><span>&nbsp;</span></p><p><span style="color:#008000;"># 建临时表用</span></p><p><span>sql</span><span style="color:#C800A4;">=</span><span style="color:#FF0000;">&quot;&quot;&quot;</span></p><p><span style="color:#FF0000;">select aladdb_dashboard_widget.widget_id from dp.aladdb_dashboard_widget left join</span></p><p><span style="color:#FF0000;">(select distinct widget_id from dp.aladdb_dashboard_board_base_df where board_id is not null and pt='%(date_1d_YMD)s') </span></p><p><span style="color:#FF0000;">a on aladdb_dashboard_widget.widget_id=a.widget_id </span></p><p><span style="color:#FF0000;">left join</span></p><p><span style="color:#FF0000;">(select get_json_object(get_json_object(job_config,'$.widget'),'$.id') as job_widget_id,'job' as job from ods.aladdb_dashboard_alarm_job_df where pt='%(date_1d_YMD)s') b</span></p><p><span style="color:#FF0000;">on aladdb_dashboard_widget.widget_id=b.job_widget_id</span></p><p><span style="color:#FF0000;">where pt='%(date_1d_YMD)s'</span></p><p><span style="color:#FF0000;">and a.widget_id is null and update_time &lt; timestamp '%(date_60d_Y_M_D)s 00:00:00' and job_widget_id is null</span></p><p><span><br></span></p><p><span style="color:#FF0000;">&quot;&quot;&quot;</span><span style="color:#C800A4;">%</span><span>{</span><span style="color:#FF0000;">'date_1d_YMD'</span><span>:date_1d_YMD,</span><span style="color:#FF0000;">'date_60d_Y_M_D'</span><span>:date_60d_Y_M_D}</span></p><p><span>&nbsp;</span></p><p><span>print(sql)</span></p><p><span>df</span><span style="color:#C800A4;">=</span><span>spark.sql(sql).repartition(</span></p><p><span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span style="color:#0000FF;">1</span><span>).foreachPartition(channelDataToRedis)</span></p><p><span><br></span></p><p><span><br></span></p><p><span><br></span></p><p><span><br></span></p>
              </div>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u571" class="ax_default label">
              <div id="u571_div" class=""></div>
              <div id="u571_text" class="text ">
                <p><span>1</span></p><p><span>2</span></p><p><span>3</span></p><p><span>4</span></p><p><span>5</span></p><p><span>6</span></p><p><span>7</span></p><p><span>8</span></p><p><span>9</span></p><p><span>10</span></p><p><span>11</span></p><p><span>12</span></p><p><span>13</span></p><p><span>14</span></p><p><span>15</span></p><p><span>16</span></p><p><span>17</span></p><p><span>18</span></p><p><span>19</span></p><p><span>20</span></p><p><span>21</span></p><p><span>22</span></p><p><span>23</span></p><p><span>24</span></p><p><span>25</span></p><p><span>26</span></p><p><span>27</span></p><p><span>28</span></p><p><span>29</span></p><p><span>30</span></p><p><span>31</span></p><p><span>32</span></p><p><span>33</span></p><p><span>34</span></p><p><span>35</span></p><p><span>36</span></p><p><span>37</span></p><p><span>38</span></p><p><span>39</span></p><p><span>40</span></p><p><span>41</span></p><p><span>42</span></p><p><span>43</span></p><p><span>44</span></p><p><span>45</span></p><p><span>46</span></p><p><span>4748</span></p><p><span>49</span></p><p><span>50</span></p><p><span>51</span></p><p><span>52</span></p><p><span>53</span></p><p><span>54</span></p><p><span>55</span></p><p><span>56</span></p><p><span>57</span></p><p><span>58</span></p><p><span>59</span></p><p><span>60</span></p><p><span>61</span></p><p><span>62</span></p><p><span>63</span></p><p><span>64</span></p><p><span>65</span></p><p><span>66</span></p><p><span>67</span></p><p><span>68</span></p><p><span>69</span></p><p><span>70</span></p><p><span>71</span></p><p><span><br></span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u572" class="ax_default paragraph">
        <div id="u572_div" class=""></div>
        <div id="u572_text" class="text ">
          <p><span style="font-family:'PingFangSC-Regular', 'PingFang SC';color:rgba(0, 0, 0, 0.647058823529412);">当前版本：</span><span style="font-family:'LucidaGrande', 'Lucida Grande';color:#FFBF00;">●</span><span style="font-family:'Helvetica';color:rgba(0, 0, 0, 0.427450980392157);"> </span><span style="font-family:'PingFangSC-Regular', 'PingFang SC';color:rgba(0, 0, 0, 0.647058823529412);">编辑版本</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u573" class="ax_default box_2">
        <div id="u573_div" class=""></div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u574" class="ax_default paragraph">
        <div id="u574_div" class=""></div>
        <div id="u574_text" class="text ">
          <p><span>任务配置</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u575" class="ax_default paragraph">
        <div id="u575_div" class=""></div>
        <div id="u575_text" class="text ">
          <p><span>pyspark配置</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u576" class="ax_default paragraph">
        <div id="u576_div" class=""></div>
        <div id="u576_text" class="text ">
          <p><span>版本控制</span></p>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u577" class="ax_default" data-left="339" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u578" class="ax_default image">
          <img id="u578_img" class="img " src="images/任务开发视窗_二）/u578.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u579" class="ax_default paragraph">
          <div id="u579_div" class=""></div>
          <div id="u579_text" class="text ">
            <p><span>测试</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u580" class="ax_default" data-left="409" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u581" class="ax_default image">
          <img id="u581_img" class="img " src="images/任务开发视窗_二）/u581.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u582" class="ax_default paragraph">
          <div id="u582_div" class=""></div>
          <div id="u582_text" class="text ">
            <p><span>发布</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u583" class="ax_default" data-left="478" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u584" class="ax_default image">
          <img id="u584_img" class="img " src="images/udf管理（正常）/u51.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u585" class="ax_default paragraph">
          <div id="u585_div" class=""></div>
          <div id="u585_text" class="text ">
            <p><span>主题</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u586" class="ax_default" data-left="548" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u587" class="ax_default image">
          <img id="u587_img" class="img " src="images/udf管理（正常）/u54.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u588" class="ax_default paragraph">
          <div id="u588_div" class=""></div>
          <div id="u588_text" class="text ">
            <p><span>字体</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u589" class="ax_default" data-left="618" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u590" class="ax_default image">
          <img id="u590_img" class="img " src="images/udf管理（正常）/u57.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u591" class="ax_default paragraph">
          <div id="u591_div" class=""></div>
          <div id="u591_text" class="text ">
            <p><span>全屏</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u592" class="ax_default" data-left="1852" data-top="126" data-width="54" data-height="24">

        <!-- Unnamed (图片 ) -->
        <div id="u593" class="ax_default image">
          <img id="u593_img" class="img " src="images/任务开发视窗_二）/u593.png"/>
        </div>

        <!-- Unnamed (矩形) -->
        <div id="u594" class="ax_default paragraph">
          <div id="u594_div" class=""></div>
          <div id="u594_text" class="text ">
            <p><span>切换</span></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u595" class="ax_default" data-left="537" data-top="76" data-width="111" data-height="40">

        <!-- Unnamed (组合 ) -->
        <div id="u596" class="ax_default" data-left="537" data-top="76" data-width="111" data-height="40">

          <!-- Unnamed (矩形) -->
          <div id="u597" class="ax_default shape">
            <div id="u597_div" class=""></div>
            <div id="u597_text" class="text ">
              <p><span style="font-family:'LucidaGrande', 'Lucida Grande';color:#00A854;">●</span><span style="font-family:'Helvetica';color:rgba(0, 0, 0, 0.427450980392157);"> </span><span style="font-family:'PingFangSC-Regular', 'PingFang SC';color:rgba(0, 0, 0, 0.647058823529412);">test_01</span></p>
            </div>
          </div>

          <!-- Unnamed (组合 ) -->
          <div id="u598" class="ax_default" data-left="622" data-top="87" data-width="24" data-height="19">

            <!-- Unnamed (图片 ) -->
            <div id="u599" class="ax_default image1">
              <img id="u599_img" class="img " src="images/udf管理（正常）/u30.png"/>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u600" class="ax_default box_2">
              <div id="u600_div" class=""></div>
              <div id="u600_text" class="text ">
                <p><span>12</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Unnamed (组合 ) -->
      <div id="u601" class="ax_default" data-left="658" data-top="76" data-width="153" data-height="40">

        <!-- Unnamed (组合 ) -->
        <div id="u602" class="ax_default" data-left="658" data-top="76" data-width="153" data-height="40">

          <!-- Unnamed (矩形) -->
          <div id="u603" class="ax_default shape">
            <div id="u603_div" class=""></div>
            <div id="u603_text" class="text ">
              <p><span style="font-family:'LucidaGrande', 'Lucida Grande';color:#00A854;">●</span><span style="font-family:'Helvetica';color:rgba(0, 0, 0, 0.427450980392157);"> </span><span style="font-family:'PingFangSC-Regular', 'PingFang SC';color:rgba(0, 0, 0, 0.647058823529412);">full_dag_start</span></p>
            </div>
          </div>

          <!-- Unnamed (组合 ) -->
          <div id="u604" class="ax_default" data-left="787" data-top="87" data-width="24" data-height="19">

            <!-- Unnamed (图片 ) -->
            <div id="u605" class="ax_default image1">
              <img id="u605_img" class="img " src="images/udf管理（正常）/u30.png"/>
            </div>

            <!-- Unnamed (矩形) -->
            <div id="u606" class="ax_default box_2">
              <div id="u606_div" class=""></div>
              <div id="u606_text" class="text ">
                <p><span>12</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u607" class="ax_default heading_2">
        <div id="u607_div" class=""></div>
        <div id="u607_text" class="text ">
          <p><span>工具栏样式调整</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u608" class="ax_default paragraph">
        <div id="u608_div" class=""></div>
        <div id="u608_text" class="text ">
          <p><span>1、去掉之前显示的任务名，任务名通过选项卡显示即可</span></p><p><span>2、工具栏高40px，与代码编辑区用分割线隔离，</span></p><p><span>&nbsp;&nbsp; &nbsp; 分割线高1px，线条颜色#e4e4e4</span></p><p><span>3、工具栏左侧显示操作按钮，右侧显示当前任务版本以及版本切换</span></p>
        </div>
      </div>

      <!-- Unnamed (椭圆形) -->
      <div id="u609" class="ax_default ellipse">
        <img id="u609_img" class="img " src="images/udf管理（保存中）/u120.png"/>
        <div id="u609_text" class="text ">
          <p><span>1</span></p>
        </div>
      </div>

      <!-- Unnamed (椭圆形) -->
      <div id="u610" class="ax_default ellipse">
        <img id="u610_img" class="img " src="images/udf管理（保存中）/u120.png"/>
        <div id="u610_text" class="text ">
          <p><span>1</span></p>
        </div>
      </div>
    </div>
  </body>
</html>
